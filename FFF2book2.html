<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book</title>
  <style>
  body {
  font-family: Arial, sans-serif;
  background-color: #fffbe7;
  padding: 20px;
  line-height: 1.6;
}

.story-container {
  max-width: 600px;
  margin: auto;
  text-align: center;
}

.book-title {
  font-size: 24px;
  font-weight: bold;
  margin-top: 80px;
  margin-bottom: 10px;
  text-align: center; 
}

.book-img {
  width: 100%;
  max-height: 300px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 15px;
}

.clickable-word {
  cursor: pointer;
  border-bottom: 1px dotted #888;
  color: inherit;
}

.clickable-word:hover {
  background-color: #ffefc1;
}

.popup {
  position: absolute; 
  background-color: white;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  z-index: 999;
  max-width: 220px;
  display: none;
}

.popup-close {
  text-align: right;
  font-weight: bold;
  cursor: pointer;
  color: red;
  margin-bottom: 5px;
}
.back-button {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
}
.back-button button {
  background-color: #d2b48c; 
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.back-button button:hover {
  background-color: #c19a6b;
.toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  z-index: 9999;
  display: none;
  opacity: 0;
  transition: opacity 0.4s ease;
.toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #333;
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  z-index: 9999;
  display: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}


.toast.show {
  animation: slideDown 0.5s ease;
  opacity: 1;
  pointer-events: auto;
}

@keyframes slideDown {
  from {
    transform: translateX(-50%) translateY(-20px);
    opacity: 0;
  }
  to {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }
}
</style>
</head>
<body>

<div class="story-container">
  <div class="book-title">The Tell-Tale Heart – Edgar Allen Poe (1843)</div>
<br>
<p id="story-text-1">It's true! yes, i have been ill, very ill. But why do you
say that I have lost control of my mind, why do you say that I am mad? Can you
not see that I have full control of my mind? Is it not clear that I am not mad?
Indeed, the illness only made my mind, my feelings, my senses stronger, more
powerful. My sense of hearing especially became more powerful. I could hear
sounds I had never heard before. I heard sounds from heaven; and I heard sounds
from hell!</p>

<p id="story-text-2">So you think that I am mad? A madman cannot plan. But you
should have seen me. During all of that week I was as friendly to the old man as
I could be, and warm, and loving. Every night about twelve o’clock I slowly
opened his door. And when the door was opened wide enough I put my hand in, and
then my head. In my hand I held a light covered over with a cloth so that no
light showed. And I stood there quietly. Then, carefully, I lifted the cloth,
just a little, so that a single, thin, small light fell across that eye. For
seven nights I did this, seven long nights, every night at midnight. Always the
eye was closed, so it was impossible for me to do the work. For it was not the
old man I felt I had to kill; it was the eye, his Evil Eye.</p>

<p id="story-text-3">And every morning I went to his room, and with a warm,
friendly voice I asked him how he had slept. He could not guess that every
night, just at twelve, I looked in at him as he slept.</p>

<p id="story-text-4">The eighth night I was more than usually careful as I
opened the door. The hands of a clock move more quickly than did my hand. Never
before had I felt so strongly my own power; I was now sure of success.</p>

<p id="story-text-5">The old man was lying there not dreaming that I was at his
door. Suddenly he moved in his bed. You may think I became afraid. But no. The
darkness in his room was thick and black. I knew he could not see the opening of
the door. I continued to push the door, slowly, softly. I put in my head. I put
in my hand, with the covered light. Suddenly the old man sat straight up in bed
and cried, “Who’s there??!”</p>

<p id="story-text-6">I stood quite still. For a whole hour I did not move. Nor
did I hear him again lie down in his bed. He just sat there, listening. Then I
heard a sound, a low cry of fear which escaped from the old man. Now I knew that
he was sitting up in his bed, filled with fear; I knew that he knew that I was
there. He did not see me there. He could not hear me there. He felt me there.
Now he knew that Death was standing there.</p>

<p id="story-text-7">Slowly, little by little, I lifted the cloth, until a
small, small light escaped from under it to fall upon — to fall upon that
vulture eye! It was open — wide, wide open, and my anger increased as it looked
straight at me. I could not see the old man’s face. Only that eye, that hard
blue eye, and the blood in my body became like ice.</p>

<p id="story-text-8">Have I not told you that my hearing had become unusually
strong? Now I could hear a quick, low, soft sound, like the sound of a clock
heard through a wall. It was the beating of the old man’s heart. I tried to
stand quietly. But the sound grew louder. The old man’s fear must have been
great indeed. And as the sound grew louder my anger became greater and more
painful. But it was more than anger. In the quiet night, in the dark silence of
the bedroom my anger became fear — for the heart was beating so loudly that I
was sure some one must hear. The time had come! I rushed into the room, crying,
“Die! Die!” The old man gave a loud cry of fear as I fell upon him and held the
bedcovers tightly over his head. Still his heart was beating; but I smiled as I
felt that success was near. For many minutes that heart continued to beat; but
at last the beating stopped. The old man was dead. I took away the bedcovers and
held my ear over his heart. There was no sound. Yes. He was dead! Dead as a
stone. His eye would trouble me no more!</p>

<p id="story-text-9">So I am mad, you say? You should have seen how careful I
was to put the body where no one could find it. First I cut off the head, then
the arms and the legs. I was careful not to let a single drop of blood fall on
the floor. I pulled up three of the boards that formed the floor, and put the
pieces of the body there. Then I put the boards down again, carefully, so
carefully that no human eye could see that they had been moved.</p>

<p id="story-text-10">As I finished this work I heard that someone was at the
door. It was now four o’clock in the morning, but still dark. I had no fear,
however, as I went down to open the door. Three men were at the door, three
officers of the police. One of the neighbors had heard the old man's cry and had
called the police, these three had come to ask questions and to search the
house.</p>

<p id="story-text-11">I asked the policemen to come in. The cry, I said, was my
own, in a dream. The old man, I said, was away; he had gone to visit a friend in
the country. I took them through the whole house, telling them to search it all,
to search well. I led them finally into the old man's bed-room. As if playing a
game with them I asked them to sit down and talk for a while.</p>

<p id="story-text-12">My easy, quiet manner made the policemen believe my story.
So they sat talking with me in a friendly way. But although I answered them in
the same way, I soon wished that they would go. My head hurt and there was a
strange sound in my ears. I talked more, and faster. The sound became elearer.
And still they sat and-talked.</p>

<p id="story-text-13">Suddenly I knew that the sound was not in my ears, it was nor just inside my head. At that moment I must have become quite white. I talked still faster and louder. And the sound, too, became louder. It was a quick, low, soft sound, like the sound of a clock heard through a wall, a sound I knew well. Louder it became, and louder. Why did the men not go? Louder, louder. I stood up and walked quickly around the room. I pushed my chair across the floor to make more noise, to cover that terrible sound. I talked even louder. And still the men sat and -talked, and smiled. Was it possible that they could not hear!</p>

<p id="story-text-14">No! They heard! I was certain of it. They knew! Now it was
they who were playing a game with me. I was suffering more than I could bear,
from their smiles, and from that sound. Louder, louder, louder! Suddenly I could
bear it no longer. I pointed at the boards and cried, "Yes! Yes, I killed him.
Pull up the boards and you shall see! I killed him. But why does his heart not
stop beating?! Why does it not stop!?</p>

<p id="story-text-15"></p>

<p id="story-text-16"></p>

<p id="story-text-17"></p>

<p id="story-text-18"></p>

<p id="story-text-19"></p>

<p id="story-text-20"></p>

<p id="story-text-21"></p>

<p id="story-text-22"></p>

<p id="story-text-23"></p>

<p id="story-text-24"></p>

<p id="story-text-25"></p>

<p id="story-text-26"></p>

<p id="story-text-27"></p>

<p id="story-text-28"></p>

<p id="story-text-29"></p>

<p id="story-text-30"></p>

<p id="story-text-31"></p>

<p id="story-text-32"></p>

<p id="story-text-33"></p>

<p id="story-text-34"></p>

<p id="story-text-35"></p>

<p id="story-text-36"></p>

<p id="story-text-37"></p>

<p id="story-text-38"></p>

<p id="story-text-39"></p>

<p id="story-text-40"></p>

<p id="story-text-41"></p>

<p id="story-text-42"></p>

<p id="story-text-43"></p>

<p id="story-text-44"></p>

<p id="story-text-45"></p>

<p id="story-text-46"></p>

<p id="story-text-47"></p>

<p id="story-text-48"></p>

<p id="story-text-49"></p>

<p id="story-text-50"></p>

<p id="story-text-51"></p>

<p id="story-text-52"></p>

<p id="story-text-53"></p>

<p id="story-text-54"></p>

<p id="story-text-55"></p>

<p id="story-text-56"></p>

<p id="story-text-57"></p>

<p id="story-text-58"></p>

<p id="story-text-59"></p>

<p id="story-text-60"></p>

<p id="story-text-61"></p>

<p id="story-text-62"></p>

<p id="story-text-63"></p>

<p id="story-text-64"></p>
<p id="story-text-65"></p>
<p id="story-text-66"></p>
<p id="story-text-67"></p>
<p id="story-text-68"></p>
<p id="story-text-69"></p>
<p id="story-text-70"></p>
<p id="story-text-71"></p>
<p id="story-text-72"></p>
<p id="story-text-73"></p>
<p id="story-text-74"></p>
<p id="story-text-75"></p>
<p id="story-text-76"></p>
<p id="story-text-77"></p>
<p id="story-text-78"></p>
<p id="story-text-79"></p>
<p id="story-text-80"></p>
<p id="story-text-81"></p>
<p id="story-text-82"></p>
<p id="story-text-83"></p>
<p id="story-text-84"></p>
<p id="story-text-85"></p>
<p id="story-text-86"></p>
<p id="story-text-87"></p>
<p id="story-text-88"></p>
<p id="story-text-89"></p>
<p id="story-text-90"></p>
<p id="story-text-91"></p>
<p id="story-text-92"></p>
<p id="story-text-93"></p>
<p id="story-text-94"></p>
<p id="story-text-95"></p>
<p id="story-text-96"></p>
<p id="story-text-97"></p>
<p id="story-text-98"></p>
<p id="story-text-99"></p>
<p id="story-text-100"></p>
</p>
</div>

<div id="toast" class="toast">Book recorded</div>

<div id="popup" class="popup" style="display: none;">
  <div class="popup-close" onclick="closePopup()">×</div>
  <div id="popup-text">Loading...</div>
</div>
<div class="back-button">
  <button onclick="window.location.href='file3.html'">← Back</button>
</div>
<script>
  const title = "Deadstar";
  const image = "deadstar.jpeg";
  const start = Date.now();
  const activeUser = localStorage.getItem("activeUser");
  let users = JSON.parse(localStorage.getItem("users") || "{}");

  document.addEventListener("DOMContentLoaded", () => {
    for (let i = 1; i <= 100; i++) {
      const storyEl = document.getElementById(`story-text-${i}`);
      if (!storyEl) continue;

      const originalText = storyEl.innerText;

      function makeWordsClickable(text) {
        return text.split(/(\s+)/).map(word => {
          if (word.trim() === "") return word;
          const clean = word.replace(/[.,!?":;()]/g, "");
          return `<span class="clickable-word" data-word="${clean}">${word}</span>`;
        }).join("");
      }

      storyEl.innerHTML = makeWordsClickable(originalText);
    }

    document.querySelectorAll(".clickable-word").forEach(word => {
      word.addEventListener("click", async (e) => {
        const rawWord = e.target.dataset.word.toLowerCase();
        const popup = document.getElementById("popup");
        const popupText = document.getElementById("popup-text");

        popupText.textContent = `Searching "${rawWord}"...`;
        popup.style.display = "block";

        const popupWidth = popup.offsetWidth;
        const pageX = e.pageX;
        const pageY = e.pageY - 60;

        if (pageX + popupWidth > window.innerWidth) {
          popup.style.left = `${window.innerWidth - popupWidth - 10}px`;
        } else {
          popup.style.left = `${pageX}px`;
        }

        if (window.innerWidth < 400) {
          popup.style.left = "10px";
          popup.style.right = "10px";
        }

        popup.style.top = `${pageY}px`;

        try {
          const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${rawWord}`);
          const data = await res.json();

          if (Array.isArray(data)) {
            const meaning = data[0]?.meanings[0]?.definitions[0]?.definition;
            popupText.textContent = `"${rawWord}" means: ${meaning}`;
          } else {
            popupText.textContent = `No definition found for "${rawWord}".`;
          }
        } catch (error) {
          popupText.textContent = `Error getting meaning.`;
        }
      });
    });

    document.addEventListener("click", (e) => {
      const popup = document.getElementById("popup");
      if (!popup.contains(e.target) && !e.target.classList.contains("clickable-word")) {
        popup.style.display = "none";
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        document.getElementById("popup").style.display = "none";
      }
    });
  });

  setTimeout(() => {
    const timeSpent = Date.now() - start;

    if (timeSpent >= 20000 && activeUser && users[activeUser]) {
      const userData = users[activeUser];
      userData.booksRead = userData.booksRead || [];

      const alreadyExists = userData.booksRead.some(book => book.title === title);
      if (!alreadyExists) {
        userData.booksRead.push({ title, image: image });
        users[activeUser] = userData;
        localStorage.setItem("users", JSON.stringify(users));

        const toast = document.getElementById("toast");
        toast.style.display = "block";
        toast.style.opacity = "1";

        setTimeout(() => {
          toast.style.opacity = "0";
          setTimeout(() => {
            toast.style.display = "none";
            toast.style.opacity = "1";
          }, 1000);
        }, 3000);
      }
    }
  }, 20000);

  window.addEventListener("beforeunload", () => {
    const end = Date.now();
    const readingTime = end - start;

    if (activeUser && users[activeUser]) {
      users[activeUser].totalReadingTime = (users[activeUser].totalReadingTime || 0) + readingTime;
      localStorage.setItem("users", JSON.stringify(users));
    }
  });

  function closePopup() {
    document.getElementById("popup").style.display = "none";
  }
</script>

</body>
</html>
